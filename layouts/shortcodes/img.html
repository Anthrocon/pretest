{{/*
	src
	alt
	hint
	filter
	link
	caption
	attr
	attrlink
*/}}

{{- $resWidths := slice "240" "480" "720" "960" "1200" "1440" "1680" "1920" "2160" "2400" "2640" "2880" "3120" "3360" "3600" "3840" -}}
{{- $sourceSizes := "(min-width: 800px) 800px, 100vw" -}}

{{/*{{- with .Page.Resources.GetMatch (.Get "src") -}}
	{{- $src := . -}}
{{- else -}}
	{{- $src := resources.Get (printf "images/%s" (.Get "src")) -}}
{{- end -}}

{{- $lqipBin := $src.Resize "16x jpg" -}}
{{- $lqipB64 := $lqipBin.Content | base64Encode -}}
{{- $divStyle := printf "background-image: url(data:image/jpeg;base64,%s);" $lqipB64 -}}

<div class="lqip" style="{{ $divStyle | safeCSS }}">
	{{ if or (.Get "caption") (.Get "attr") }}<figure>{{ end }}
		{{ with .Get "link" }}<a href="{{ . }}">{{ end }}
			<picture>
				<source type="image/webp" srcset="
					{{- with $resWidths -}}
						{{- range $i, $e := . -}}
							{{- if ge $src.Width . -}}
								{{- if $i }}, {{ end }}{{ ($src.Resize (printf "%sx webp" . )).RelPermalink }} {{ . }}w
							{{- end -}}
						{{- end -}}
					{{- end }}" sizes="{{ $sourceSizes }}">
				<source type="image/jpeg" srcset="
				{{- with $resWidths -}}
					{{- range $i, $e := . -}}
						{{- if ge $src.Width . -}}
							{{- if $i }}, {{ end }}{{ ($src.Resize (printf "%sx jpg" . )).RelPermalink }} {{ . }}w
						{{- end -}}
					{{- end -}}
				{{- end -}}" sizes="{{ $sourceSizes }}">
				<img class="h-auto" src="{{ ($src.Resize "760x jpg").RelPermalink }}" alt="{{ with .Get "alt" }}{{ . }}{{ else }}{{ .Get "caption" | markdownify | plainify }}{{ end }}" width="{{ $src.Width }}" height="{{ $src.Height }}">
			</picture>
		{{ if .Get "link" }}</a>{{ end }}
		{{ if or (.Get "caption") (.Get "attr") }}<figcaption>
			{{ .Get "caption" | markdownify }}
			{{ with .Get "attrlink" }}<a href="{{ . }}">{{ end }}{{ .Get "attr" | markdownify }}{{ if .Get "attrlink" }}</a>{{ end }}
		</figcaption>
	</figure>{{ end }}
</div>*/}}
